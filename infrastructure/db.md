# DB設計
* 各DBMSマニュアルが示す構文図は仕組みがよく分かる。
* トランザクション管理、排他制御、障害回復、レプリケーション

## 概念設計
* [DB設計におけるエンティティやER図] 始めは難しいが経験を積めば自然とできる。普段からエンティティ関係図をイメージするようにしよう。
* [PKが備えるべき特性] 必ず何らかの値を持つ非null性、 他と重複しない一意性、値が変化することはない不変性。項目一覧から候補キーを探すときは一意に識別できるかを考えるのがポイント。

## 論理設計
* [正規形] すべての行のすべての列に1つずつ値が入っているべきであり、セルの重複のような形をなくす。ある列Aの値が決まれば、自ずとBの値も決まる関係を関数従属と言い、すべての非キー列は主キーにきれいに関数従属すべきである。複合主キーの場合は、複合主キー全体に対して関数従属となるべき。また、主キーに関数従属になっている列に対して、さらに関数従属になっている列は切り出す。
* 第1正規形は行内に重複がない状態、第2正規形は主キーが決まれば他の値が決まる状態、第3正規形は主キー以外の値によって決まる値がない状態。
* [正規化しないケース] データ更新を行わないもの（ログやデータハウス、データ履歴などの追記するだけのもの）、性能を最重視するもの。

## 物理設計
* 列名の決定、型の決定、制約やデフォルト値、インデックス、その他ビューなど。

## NOT NULL
* アプリコードに頼らず、データベースで一貫した制約を強制することがてきる。
* NULLがアプリのポリシー違反に反するケースや、列においてNULLが意味をなさない場合はつけるべき。

## 権限
* ユーザーとロールに権限を付与できる。ロール自体はユーザーに付与する。
* ユーザーに付与した権限とロールに付与した権限で、最も包括的な権限が付与される。

# トランザクション
* トランザクション内の処理は、すべて更新してコミットするか、すべて取り消すかのどちらかしかなく、途中かけにはならない仕組み。
* トランザクション内処理を取り消すことをロールバック。
* ディスク障害などでDBが壊れてしまった場合などに、バックアップから復元し、更新後ジャーナルから更新情報を取得して、故障直前まで戻すことをロールフォワード。

# 排他制御、ロック
* 共有ロックは、他者が読むことは許され、書き込みは許されない。専有ロックはどちらも許されない。

# インデックス
DBでインデックスを貼る時はカーディナリティを意識する。どんなデータがどんな分布で入るのかを想定して設計する。

# 3値論理
* Trueかどうかを判定するように考えれば分かりやすい。その中でFalseと断定できなければNull。
* True and Null はNullがどちらか分からないのでNull
* Null and False はすでにFalseが確定しているからFalse
* Null or True はTrueが確定しているからTrve

# others
* DBの排他制御では防げない部分は楽観ロックなどの考え方で対処する必要がある。ロックキーとしてはバージョンが推奨される。

# トラブルシューティング

## Oracle

### tnsnames.oraファイルの内容がうまく読み取られない
スペースでインデントを付けてみる。
その後読み取るようになってから、再度スペースを消してもきちんと読み取ったため、正確に原因は不明。

# データベースのスキーマ、システムのデータ構造の把握
## コツ

1. **ER図の作成**: エンティティ関連図 (ER図) を作成することで、テーブル間の関係を視覚的に理解できます。

2. **重要なテーブルの特定**: データベース内で中心となるテーブルや頻繁に使われるテーブルを特定します。

3. **カラムの理解**: 各テーブルのカラムとそのデータ型を確認し、どのような情報が格納されているかを理解します。

4. **リレーションシップの分析**: 外部キー、参照整合性などを分析して、テーブル間の関連性を理解します。

5. **文書化**: スキーマの情報を文書化して、疑問点や不明点を明確にします。

6. **クエリの実行**: 実際にクエリを実行してみることで、データの流れや関連性をより深く理解できます。

7. **チームとのコミュニケーション**: 既存の開発者やDBAに質問し、システムの背景や特定の設計選択の理由を理解します。

8. **ドキュメントの活用**: 既存のドキュメントやスキーマ定義を参照して、全体像をつかみます。


## 外部キー制約が付加されていない場合

1. **カラム名のパターン**: カラム名に一貫した命名規則があれば、それを手がかりに関連するテーブルを推測できます。例えば、あるテーブルに `customer_id` というカラムがあり、別のテーブルに `id` というカラムがある場合、これらが関連している可能性があります。

2. **データ型とサイズの一致**: 互いに関連していそうなカラムが同じデータ型やサイズを持っている場合、それらが関連している可能性があります。

3. **データの一致**: 異なるテーブルのカラムで、データの値が一致するものがあれば、それらが関連している可能性があります。

4. **アプリケーションコードの分析**: アプリケーションコードを分析して、どのテーブルが一緒に使われているかを調べることで関連性を見つけることができます。

5. **文書やドキュメントの確認**: データベース設計に関する文書やドキュメントがあれば、そこから関連性を把握することができます。

6. **開発者やDBAへの確認**: データベースの設計や運用に関わっている開発者やデータベース管理者に直接尋ねるのも一つの方法です。
